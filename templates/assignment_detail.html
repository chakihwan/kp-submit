{% extends 'base.html' %}
{% block title %}과제 상세{% endblock %}
{% block content %}
<div class="grid gap-4">
  <!-- 상단: 과제 요약 + 제출 버튼 -->
  <div class="rounded-2xl border bg-white p-4 shadow-sm">
    <div class="flex items-start justify-between">
      <div>
        <div class="text-xs text-gray-500">{{ course.title }}</div>
        <div class="text-2xl font-bold">{{ a.title }}</div>
        <div class="text-sm text-gray-500 mt-1">마감: {{ a.due_at }} · 상태: {{ a.status }}</div>
      </div>
      <a href="{% url 'submission_form' assignment_id=a.id %}"
        class="px-4 py-2 rounded-xl bg-gray-900 text-white">제출하기</a>
    </div>
    <p class="text-sm text-gray-600 mt-3">
      설명: 과제 요구사항을 따르고, PDF로 제출하세요. 코드가 있을 경우 ZIP 포함.
    </p>
  </div>

{% if user_submission %}
  <div class="rounded-2xl border bg-white p-4 shadow-sm">
    <div class="font-semibold mb-2">내 제출 상태</div>
    <p class="text-sm">
      상태: {{ user_submission.get_status_display }}
      {% if user_submission.submitted_at %} · 시간: {{ user_submission.submitted_at|date:"Y-m-d H:i" }}{% endif %}
    </p>

    {% if user_submission.files.all %}
      <div class="mt-2 text-sm">
        파일:
        {% for f in user_submission.files.all %}
          <a class="underline text-blue-600" href="{{ f.file.url }}">v{{ f.version }}</a>{% if not forloop.last %}, {% endif %}
        {% endfor %}
      </div>
    {% endif %}

    <div class="mt-3 flex items-center gap-2">
      <a href="{% url 'submission_form' assignment_id=a.id %}"
         class="px-3 py-1 rounded bg-gray-900 text-white text-sm">재제출 / 수정</a>

      {% if user_submission and user_submission.status in "submitted,late" %}
      <form method="post" action="{% url 'cancel_submission' assignment_id=a.id %}"
            onsubmit="return confirm('제출을 취소할까요?');">
        {% csrf_token %}
        <button type="submit" class="px-3 py-1 rounded bg-gray-200 text-sm">제출 취소</button>
      </form>
      {% endif %}
    </div>
  </div>
{% endif %}

{% endblock %}
