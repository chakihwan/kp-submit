{% extends 'base.html' %}
{% block title %}과제 상세{% endblock %}
{% block content %}
<div class="grid gap-4">
  <div class="rounded-2xl border bg-white p-6 shadow-sm">
    <div class="flex items-start justify-between">
    <div>
        <h1 class="text-xl font-semibold">{{ a.title }}</h1>
        <div class="text-sm text-gray-600">
        마감: {{ a.due_at|date:"Y-m-d H:i" }}
        · 배점 {{ a.max_score }}
        · {% if a.is_closed %}<span class="text-red-600 font-semibold">마감됨</span>{% else %}진행중{% endif %}
        </div>
    </div>

        <!-- 과제 목록으로 돌아가기 -->
        <a class="px-3 py-1.5 rounded-lg border text-sm hover:bg-gray-50"
        href="{% url 'team_detail' team_id=team.id %}">
        과제 목록으로 돌아가기
        </a>
    </div>

      <!-- 출제자(팀장) 버튼 -->
      {% if is_owner %}
      <div class="flex gap-2">
        <a class="px-3 py-1.5 rounded-lg border text-sm hover:bg-gray-50"
           href="{% url 'assignment_submissions' team_id=team.id assignment_id=a.id %}">
          제출 현황
        </a>
        {% if a.is_closed %}
          <a class="px-3 py-1.5 rounded-lg bg-gray-700 text-white text-sm hover:bg-gray-600"
             href="{% url 'assignment_reopen' team_id=team.id assignment_id=a.id %}">
            마감 해제
          </a>
        {% else %}
          <a class="px-3 py-1.5 rounded-lg bg-red-600 text-white text-sm hover:bg-red-500"
             href="{% url 'assignment_close' team_id=team.id assignment_id=a.id %}">
            과제 마감
          </a>
        {% endif %}
      </div>
      {% endif %}
    </div>

    <!-- <p class="mt-3 text-gray-700 whitespace-pre-line">{{ a.description|default:"(설명 없음)" }}</p> -->
  </div>

  <!-- 학생 영역 -->
  {% if not is_owner %}
  <div class="rounded-2xl border bg-white p-6 shadow-sm">
    {% if my_grade %}
      <div class="mb-3 rounded-xl border bg-green-50 p-3 text-green-800">
        채점 완료 · 점수 <strong>{{ my_grade.score }}</strong> / {{ a.max_score }}
        {% if my_grade.feedback_text %}<div class="text-sm mt-1">피드백: {{ my_grade.feedback_text }}</div>{% endif %}
      </div>
    {% endif %}

    <div class="flex items-center justify-between">
      <h2 class="text-lg font-semibold">내 제출</h2>
      {% if can_edit %}
        <a class="px-3 py-1.5 rounded-lg bg-blue-600 text-white text-sm hover:bg-blue-500"
           href="{% url 'assignment_submit' team_id=team.id assignment_id=a.id %}">
          {% if my_sub and my_sub.status != "not_submitted" %}제출 수정하기{% else %}제출하기{% endif %}
        </a>
      {% endif %}
    </div>

    {% if my_sub %}
      <div class="mt-3 text-sm text-gray-700">
        상태: {{ my_sub.get_status_display|default:my_sub.status }}
        {% if my_sub.submitted_at %} · 제출시각: {{ my_sub.submitted_at|date:"Y-m-d H:i" }}{% endif %}
        <div class="mt-2">파일:
          {% for f in my_sub.files.all %}
            <a class="underline text-blue-600" href="{{ f.file.url }}" download>v{{ f.version }}</a>{% if not forloop.last %}, {% endif %}
          {% empty %}-{% endfor %}
        </div>
      </div>
    {% else %}
      <p class="mt-3 text-sm text-gray-600">아직 제출하지 않았습니다.</p>
    {% endif %}
  </div>
  {% endif %}
</div>
{% endblock %}
