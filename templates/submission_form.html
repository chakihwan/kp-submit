{% extends 'base.html' %}
{% block title %}제출 작성{% endblock %}
{% block content %}
<div class="rounded-2xl border bg-white p-4 shadow-sm max-w-2xl">
  <div class="font-semibold mb-3">제출 작성 — {{ a.title }}</div>

  {% if messages %}
    <div class="mb-2">
      {% for m in messages %}
        <div class="text-sm {% if m.tags == 'error' %}text-red-600{% else %}text-green-700{% endif %}">{{ m }}</div>
      {% endfor %}
    </div>
  {% endif %}

  <form method="post" enctype="multipart/form-data">
    {% csrf_token %}
    <div class="grid gap-4">
      <div>
        <label class="text-sm text-gray-600">제출 메모</label>
        {{ form.comment }}
      </div>
      <div>
        <label class="text-sm text-gray-600">파일 첨부</label>
        <input type="file" name="file" required class="mt-1">
        <p class="text-xs text-gray-500 mt-1">허용: PDF/ZIP · 20MB 이하</p>
        {% if form.file.errors %}
          <p class="text-xs text-red-600 mt-1">{{ form.file.errors.0 }}</p>
        {% endif %}
      </div>

      <div class="flex items-center gap-2">
        <a href="{% url 'assignment_detail' a.id %}" class="px-4 py-2 rounded-xl bg-gray-200">취소</a>
        <button class="px-4 py-2 rounded-xl bg-gray-900 text-white" type="submit">제출하기</button>
      </div>
    </div>
  </form>

{% if sub.files.all %}
  <div class="mt-6">
    <div class="text-sm font-semibold mb-2">내 제출 파일</div>
    <ul class="list-disc ml-5 text-sm space-y-1">
      {% for f in sub.files.all %}
        <li class="flex items-center gap-3">
          <a class="underline text-blue-600" href="{{ f.file.url }}">v{{ f.version }}</a>
          <span class="text-gray-500">({{ f.size }} bytes)</span>

          <!-- 삭제 버튼 (POST) -->
          <form method="post" action="{% url 'submission_file_delete' assignment_id=a.id file_id=f.id %}" onsubmit="return confirm('이 파일을 삭제할까요?');">
            {% csrf_token %}
            <button type="submit" class="text-red-600 underline">삭제</button>
          </form>
        </li>
      {% endfor %}
    </ul>
  </div>
{% endif %}
{% endblock %}