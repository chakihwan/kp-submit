{% extends 'base.html' %}
{% block title %}교수자 대시보드{% endblock %}
{% block content %}
<div class="grid gap-4">
  <div class="rounded-2xl border bg-white p-4 shadow-sm">
    <div class="flex items-center justify-between">
      <div class="font-semibold">담당 과목</div>
      <a href="{% url 'teacher_assignment_create' %}" class="px-3 py-1 rounded bg-gray-900 text-white text-sm">새 과제 만들기</a>
    </div>

    <!-- 과목 리스트 + 팀 관리/생성 버튼 -->
    <div class="mt-3 space-y-2">
    {% for c in courses %}
        <div class="flex items-center justify-between border rounded-xl p-3">
        <div>
            <div class="font-medium">{{ c.title }}</div>
            <div class="text-sm text-gray-500">{{ c.code }}</div>
        </div>

        <div class="flex gap-2">
            <!-- ✅ c는 Course 객체이므로 c.id 사용 -->
            <a href="{% url 'course_teams' course_id=c.id %}" class="px-3 py-1 rounded border">팀 관리</a>

            {% if request.user == c.teacher or request.user.id == c.teacher_id %}
            <a href="{% url 'create_team' course_id=c.id %}" class="px-3 py-1 rounded bg-blue-600 text-white">팀 만들기</a>
            {% endif %}
        </div>
        </div>
    {% empty %}
        <div class="text-gray-500">담당 과목이 없습니다.</div>
    {% endfor %}
    </div>

  <div class="rounded-2xl border bg-white p-4 shadow-sm">
    <div class="font-semibold mb-2">최근 과제</div>
    <div class="overflow-auto rounded-xl border">
      <table class="min-w-full text-sm">
        <thead class="bg-gray-50">
          <tr>
            <th class="px-3 py-2">제목</th>
            <th class="px-3 py-2">과목</th>
            <th class="px-3 py-2">마감</th>
            <th class="px-3 py-2">제출 현황</th>
            <th class="px-3 py-2">관리</th>
          </tr>
        </thead>
        <tbody>
          {% for a in recent_assignments %}
          <tr class="border-t">
            <td class="px-3 py-2">{{ a.title }}</td>
            <td class="px-3 py-2">{{ a.course.title }}</td>
            <td class="px-3 py-2">{{ a.due_at|date:"Y-m-d H:i" }}</td>
            <td class="px-3 py-2">
              {{ a.submission_set.count }}건
            </td>
            <td class="px-3 py-2">
              <a href="{% url 'teacher_submissions' a.id %}" class="px-2 py-1 rounded bg-gray-900 text-white text-xs">제출 보기</a>
            </td>
          </tr>
          {% empty %}
          <tr><td colspan="5" class="px-3 py-4 text-gray-500">최근 과제가 없습니다.</td></tr>
          {% endfor %}
        </tbody>
      </table>
    </div>
  </div>
</div>
{% endblock %}
